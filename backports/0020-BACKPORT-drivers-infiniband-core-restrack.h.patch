From: Talat Batheesh <talatb@mellanox.com>
Subject: [PATCH] BACKPORT: drivers/infiniband/core/restrack.h

Change-Id: I4c2478f8a28810172a7e4649e40fe028f5f77b26
---
 drivers/infiniband/core/restrack.h | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/drivers/infiniband/core/restrack.h b/drivers/infiniband/core/restrack.h
index xxxxxxx..xxxxxxx 100644
--- a/drivers/infiniband/core/restrack.h
+++ b/drivers/infiniband/core/restrack.h
@@ -7,12 +7,28 @@
 #define _RDMA_CORE_RESTRACK_H_
 
 #include <linux/mutex.h>
+#include <linux/hashtable.h>
+
+#ifndef HAVE_XARRAY
+#define RDMA_RESTRACK_HASH_BITS 8
+#endif
 
 /**
  * struct rdma_restrack_root - main resource tracking management
  * entity, per-device
  */
 struct rdma_restrack_root {
+#ifndef HAVE_XARRAY 
+	/*
+	 *          * @rwsem: Read/write lock to protect lists
+	 *                   */
+	struct rw_semaphore     rwsem;
+	/**
+	 *          * @hash: global database for all resources
+	 *          per-device
+	 *                   */
+	DECLARE_HASHTABLE(hash, RDMA_RESTRACK_HASH_BITS);
+#endif
 	/**
 	 * @xa: Array of XArray structure to hold restrack entries.
 	 */
